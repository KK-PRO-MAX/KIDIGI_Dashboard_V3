import{_ as H,J as K,r as b,o as G,c as Q,z as k,a as h,b as I,d as i,e as o,w as n,u as p,K as X,i as T,g,F as Z,l as ee,L as S,M as A,t as x,N as C,m as s,I as te}from"./index-v1DWNmr-.js";import{b as le,f as ae,h as V,i as oe,j as se,k as re}from"./locker-DrIPEVPp.js";import"./index-B9ygI19o.js";const ne={class:"locker-container"},de={class:"header-bar"},ie={class:"action-buttons"},ue={class:"locker-grid"},ce={class:"card-content"},pe={class:"info-section"},ye={class:"label-row"},ve={class:"label"},ge={class:"label label-right"},me={class:"value-row"},fe={class:"department-value"},be={class:"devices-value"},_e={class:"label"},ke={class:"bays-value"},Te={class:"button-row"},Le={class:"dialog-footer"},Ne={__name:"Locker_Type",setup(Be){const E=K(),_=b(!1),L=b(!1),D=b(-1),e=b({id:null,department:"",baysNumber:null,assignedBays:""}),P=()=>{E.back()},v=b(null),m=b(-1),f=b(null),u=b([]),R=async()=>{try{const l=localStorage.getItem("token");if(console.log("Token检查:",l?"存在":"不存在"),!l){s.warning("未找到token，请先登录");return}console.log("=== 开始请求Locker Type列表 ===");const t=await le();console.log("=== API响应成功 ==="),console.log("响应状态:",t.status),console.log("响应数据:",t.data);const a=t.data;if(a.ret===0&&(a.code===200||a.code==="200")){const d=a.ret_data||[];Array.isArray(d)?(u.value=d.map(r=>({id:r.id,lockerTypeId:r.id,department:r.locker_type,devicesAssigned:r.bay_total,assignedBays:r.detail})),console.log("✓ Locker Type数据加载成功，共",u.value.length,"条"),u.value.length>0?s.success(`Loading successful ${u.value.length} 条Locker Type数据`):s.info("暂无Locker Type数据")):(s.error("数据格式错误"),u.value=[])}else console.error("✗ API返回错误:",a),s.error(a.msg||"加载Locker Type数据失败"),u.value=[]}catch(l){console.error("=== 请求失败 ==="),console.error("错误对象:",l),s.error("获取Locker Type列表失败，请检查网络或token是否有效"),u.value=[]}};G(()=>{R()});const J=Q(()=>u.value),F=async l=>{if(l===-1||l>=u.value.length)return;const t=u.value[l];if(!t||!t.id){s.error("Invalid locker type");return}te.confirm("Are you sure you want to delete this locker type? You will have 30 seconds to restore it.",{confirmButtonText:"Delete",cancelButtonText:"Cancel",type:"warning",confirmButtonClass:"confirm-delete-btn",cancelButtonClass:"cancel-delete-btn"}).then(async()=>{try{console.log("开始删除Locker Type，ID:",t.id),v.value={...t},m.value=l,u.value.splice(l,1),console.log("✓ 已从列表中删除");const d=(await se({id:t.id})).data;if(d.ret===0&&(d.code===200||d.code==="200")){console.log("✓ Delete API successful");const r=s({type:"success",duration:3e4,showClose:!0,dangerouslyUseHTMLString:!0,message:`
            <div style="display: flex; align-items: center; justify-content: space-between; gap: 20px;">
              <span>Locker type deleted successfully. You have 30 seconds to restore it.</span>
              <button 
                id="restore-btn" 
                style="
                  background-color: #0C306C; 
                  color: white; 
                  border: none; 
                  padding: 6px 16px; 
                  border-radius: 4px; 
                  cursor: pointer;
                  font-weight: 600;
                  white-space: nowrap;
                "
              >
                Restore
              </button>
            </div>
          `,onClose:()=>{v.value=null,m.value=-1,f.value&&(clearTimeout(f.value),f.value=null)}});setTimeout(()=>{const c=document.getElementById("restore-btn");c&&(c.onclick=()=>{q(),r.close()})},100),f.value=setTimeout(()=>{v.value=null,m.value=-1,f.value=null},3e4)}else console.error("✗ Delete API failed:",d),u.value.splice(m.value,0,v.value),s.error(d.msg||"Failed to delete locker type")}catch(a){console.error("Delete request error:",a),v.value&&m.value!==-1&&u.value.splice(m.value,0,v.value),s.error("Failed to delete locker type")}}).catch(()=>{console.log("User cancelled deletion"),s.info("Delete cancelled")})},q=async()=>{if(!(!v.value||m.value===-1))try{if(console.log("开始恢复Locker Type，ID:",v.value.id),!v.value.id){s.error("Invalid locker type ID");return}u.value.splice(m.value,0,v.value),console.log("✓ Local data restored to list");const t=(await re({id:v.value.id})).data;t.ret===0&&(t.code===200||t.code==="200")?(console.log("✓ Restore API successful"),s.success("Locker type restored successfully")):(console.error("✗ Restore API failed:",t),s.warning(t.msg||"Restore API failed, but local data has been restored"))}catch(l){console.error("Restore request error:",l),s.warning("Restore request error, but local data has been restored")}finally{v.value=null,m.value=-1,f.value&&(clearTimeout(f.value),f.value=null)}},O=()=>{L.value=!1,D.value=-1,e.value={id:null,department:"",baysNumber:null,assignedBays:""},_.value=!0},U=async(l,t)=>{L.value=!0,D.value=t,console.log("Open edit dialog"),console.log("原始数据:",JSON.stringify(l)),e.value={id:l.id,department:l.department,baysNumber:Number(l.devicesAssigned),assignedBays:l.assignedBays},console.log("Data converted:",JSON.stringify(e.value)),console.log("department:",e.value.department,"类型:",typeof e.value.department),console.log("baysNumber:",e.value.baysNumber,"类型:",typeof e.value.baysNumber),console.log("assignedBays:",e.value.assignedBays,"类型:",typeof e.value.assignedBays),_.value=!0;try{console.log("Background fetching Locker Type details, ID:",l.id);const d=(await V({id:l.id})).data;if(d.ret===0&&(d.code===200||d.code==="200")){const r=d.ret_data;console.log("接口返回数据:",JSON.stringify(r)),e.value={id:r.id,department:r.locker_type,baysNumber:Number(r.bay_total),assignedBays:r.detail},console.log("Interface data updated:",JSON.stringify(e.value)),console.log("✓ Updated edit form with interface data")}}catch(a){console.error("Failed to get Locker Type details, keeping local data:",a)}},M=()=>!e.value.department||!e.value.department.trim()?(s.warning("Please enter locker type name"),!1):e.value.baysNumber===null||e.value.baysNumber===""||e.value.baysNumber===void 0?(s.warning("Please select bays number"),!1):!e.value.assignedBays||!e.value.assignedBays.trim()?(s.warning("Please enter detailed description"),!1):!0,$=async()=>{try{if(!e.value.id){s.error("Invalid locker type ID");return}if(!e.value.department||!String(e.value.department).trim()){s.error("Locker Type is required"),console.error("编辑校验失败：locker_type为空");return}if(e.value.baysNumber===null||e.value.baysNumber===void 0||e.value.baysNumber===""){s.error("Bays Number is required"),console.error("编辑校验失败：bay_total为空");return}if(!e.value.assignedBays||!String(e.value.assignedBays).trim()){s.error("Detail is required"),console.error("编辑校验失败：detail为空");return}console.log("开始编辑Locker Type，ID:",e.value.id),console.log("编辑表单完整数据:",JSON.stringify(e.value));const l={id:e.value.id,locker_type:String(e.value.department).trim(),bay_total:Number(e.value.baysNumber),detail:String(e.value.assignedBays).trim()};console.log("核查编辑参数：",JSON.stringify(l)),console.log("locker_type日常：",l.locker_type,"类型:",typeof l.locker_type),console.log("bay_total日常：",l.bay_total,"类型:",typeof l.bay_total),console.log("detail日常：",l.detail,"类型:",typeof l.detail);const a=(await ae(l)).data;if(a.ret===0&&(a.code===200||a.code==="200")){console.log("✓ 编辑成功");const d=u.value.findIndex(r=>r.id===e.value.id);d!==-1&&(u.value[d]={id:e.value.id,lockerTypeId:e.value.id,department:e.value.department.trim(),devicesAssigned:Number(e.value.baysNumber),assignedBays:e.value.assignedBays.trim()},console.log("✓ 已用本地数据更新卡片"));try{const c=(await V({id:e.value.id})).data;if(c.ret===0&&(c.code===200||c.code==="200")){const N=u.value.findIndex(B=>B.id===e.value.id);N!==-1&&(u.value[N]={id:c.ret_data.id,lockerTypeId:c.ret_data.id,department:c.ret_data.locker_type,devicesAssigned:Number(c.ret_data.bay_total),assignedBays:c.ret_data.detail},console.log("✓ 已用接口数据更新卡片"))}}catch(r){console.error("获取最新数据失败，保持本地数据:",r)}s.success("Locker type updated successfully"),_.value=!1}else console.error("✗ 编辑失败:",a),s.error(a.msg||"Failed to update locker type")}catch(l){console.error("编辑请求出错:",l),s.error("Failed to update locker type")}},j=async()=>{try{if(console.log("开始添加Locker Type"),console.log("添加表单完整数据:",JSON.stringify(e.value)),!e.value.department||!String(e.value.department).trim()){s.error("Locker Type is required"),console.error("添加校验失败：locker_type为空");return}if(e.value.baysNumber===null||e.value.baysNumber===void 0||e.value.baysNumber===""){s.error("Bays Number is required"),console.error("添加校验失败：bay_total为空");return}if(!e.value.assignedBays||!String(e.value.assignedBays).trim()){s.error("Detail is required"),console.error("添加校验失败：detail为空");return}const l={locker_type:String(e.value.department).trim(),bay_total:Number(e.value.baysNumber),detail:String(e.value.assignedBays).trim()};console.log("核查添加参数：",JSON.stringify(l)),console.log("locker_type内容：",l.locker_type,"类型:",typeof l.locker_type,"长度:",l.locker_type.length),console.log("bay_total内容：",l.bay_total,"类型:",typeof l.bay_total),console.log("detail内容：",l.detail,"类型:",typeof l.detail,"长度:",l.detail.length);const a=(await oe(l)).data;if(a.ret===0&&(a.code===200||a.code==="200")){console.log("✓ 添加成功，返回的ID:",a.ret_data);const d={id:a.ret_data,lockerTypeId:a.ret_data,department:e.value.department,devicesAssigned:Number(e.value.baysNumber),assignedBays:e.value.assignedBays};u.value.push(d),s.success("Locker type added successfully"),_.value=!1}else console.error("✗ 添加失败:",a),s.error(a.msg||"Failed to add locker type")}catch(l){console.error("添加请求出错:",l),s.error("Failed to add locker type")}},W=()=>{M()&&(L.value?$():j())};return(l,t)=>{const a=k("el-button"),d=k("el-input"),r=k("el-form-item"),c=k("el-option"),N=k("el-select"),B=k("el-form"),Y=k("el-dialog");return I(),h("div",ne,[i("div",de,[o(p(T),{class:"back-arrow",onClick:P},{default:n(()=>[o(p(X))]),_:1}),t[6]||(t[6]=i("h2",null,"Locker Type",-1)),i("div",ie,[o(a,{type:"",style:{"background-color":"#0C306C",color:"#fff","font-weight":"600"},onClick:O},{default:n(()=>[...t[5]||(t[5]=[g(" Add Locker Type ",-1)])]),_:1})])]),i("div",ue,[(I(!0),h(Z,null,ee(J.value,(y,w)=>(I(),h("div",{key:w,class:"locker-card"},[i("div",ce,[i("div",pe,[i("div",ye,[i("span",ve,[o(p(T),{style:{"margin-right":"6px","vertical-align":"middle"}},{default:n(()=>[o(p(S))]),_:1}),t[7]||(t[7]=g(" Locker Type ",-1))]),i("span",ge,[o(p(T),{style:{"margin-right":"6px","vertical-align":"middle"}},{default:n(()=>[o(p(A))]),_:1}),t[8]||(t[8]=g(" Bays Number ",-1))])]),i("div",me,[i("span",fe,x(y.department),1),i("span",be,x(y.devicesAssigned),1)]),i("p",null,[i("span",_e,[o(p(T),{style:{"margin-right":"6px","vertical-align":"middle"}},{default:n(()=>[o(p(C))]),_:1}),t[9]||(t[9]=g(" Detail ",-1))])]),i("p",ke,x(y.assignedBays),1),i("div",Te,[o(a,{type:"",class:"action-btn edit-btn",onClick:z=>U(y,w)},{default:n(()=>[...t[10]||(t[10]=[g(" Edit ",-1)])]),_:1},8,["onClick"]),o(a,{class:"action-btn delete-btn",onClick:z=>F(w)},{default:n(()=>[...t[11]||(t[11]=[g(" Delete ",-1)])]),_:1},8,["onClick"])])])])]))),128))]),o(Y,{modelValue:_.value,"onUpdate:modelValue":t[4]||(t[4]=y=>_.value=y),title:L.value?"Edit Locker Type":"Add Locker Type",width:"565px",style:{"--you-dialog-width":"565px","font-weight":"700",color:"#000",gap:"28px","border-radius":"24px","padding-top":"52px","padding-right":"24px","padding-bottom":"52px","padding-left":"24px"},"custom-class":"custom-dialog","close-on-click-modal":!1},{footer:n(()=>[i("span",Le,[o(a,{type:"default",class:"cancel-btn",onClick:t[3]||(t[3]=y=>_.value=!1)},{default:n(()=>[...t[15]||(t[15]=[g("Cancel",-1)])]),_:1}),o(a,{type:"primary",class:"save-btn",onClick:W},{default:n(()=>[...t[16]||(t[16]=[g("Save",-1)])]),_:1})])]),default:n(()=>[o(B,{model:e.value,"label-position":"top",class:"location-form"},{default:n(()=>[o(r,null,{label:n(()=>[i("span",null,[o(p(T),{style:{"margin-right":"6px","vertical-align":"middle"}},{default:n(()=>[o(p(S))]),_:1}),t[12]||(t[12]=g(" Locker Type* ",-1))])]),default:n(()=>[o(d,{modelValue:e.value.department,"onUpdate:modelValue":t[0]||(t[0]=y=>e.value.department=y),placeholder:"Enter locker type (e.g., RJW-32, RJW-33)"},null,8,["modelValue"])]),_:1}),o(r,null,{label:n(()=>[i("span",null,[o(p(T),{style:{"margin-right":"6px","vertical-align":"middle"}},{default:n(()=>[o(p(A))]),_:1}),t[13]||(t[13]=g(" Bays Number* ",-1))])]),default:n(()=>[o(N,{modelValue:e.value.baysNumber,"onUpdate:modelValue":t[1]||(t[1]=y=>e.value.baysNumber=y),placeholder:"Select bays number",style:{width:"100%"}},{default:n(()=>[o(c,{label:"24",value:24}),o(c,{label:"32",value:32}),o(c,{label:"36",value:36}),o(c,{label:"48",value:48}),o(c,{label:"60",value:60}),o(c,{label:"72",value:72})]),_:1},8,["modelValue"])]),_:1}),o(r,null,{label:n(()=>[i("span",null,[o(p(T),{style:{"margin-right":"6px","vertical-align":"middle"}},{default:n(()=>[o(p(C))]),_:1}),t[14]||(t[14]=g(" Detail* ",-1))])]),default:n(()=>[o(d,{modelValue:e.value.assignedBays,"onUpdate:modelValue":t[2]||(t[2]=y=>e.value.assignedBays=y),placeholder:"Enter detailed description",type:"textarea",rows:3},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},xe=H(Ne,[["__scopeId","data-v-95b950d6"]]);export{xe as default};
