import{Y as v,r as l,m as i}from"./index-CZ0eQXdI.js";import{a as y}from"./index-B9ygI19o.js";const n=e=>new Promise(o=>setTimeout(o,e)),u=y.create({baseURL:"https://guiz.haomengwl.com/api",timeout:1e4,headers:{"Content-Type":"application/json"}});u.interceptors.request.use(e=>{var r;const o=localStorage.getItem("token");return o&&(e.headers.token=o),console.log("Device Type API 发送请求:",(r=e.method)==null?void 0:r.toUpperCase(),e.url),console.log("请求数据:",e.data),e},e=>(console.error("请求拦截器错误:",e),Promise.reject(e)));u.interceptors.response.use(e=>(console.log("Device Type API 收到响应:",e.status,e.data),e.data&&typeof e.data=="object"&&(e.data.ret!==void 0&&console.log("  ✓ ret:",e.data.ret),e.data.code!==void 0&&console.log("  ✓ code:",e.data.code),e.data.msg!==void 0&&console.log("  ✓ msg:",e.data.msg),e.data.ret_data!==void 0&&(console.log("  ✓ ret_data 类型:",Array.isArray(e.data.ret_data)?"Array":typeof e.data.ret_data),Array.isArray(e.data.ret_data)&&console.log("    数据数量:",e.data.ret_data.length))),e),e=>(console.error("Device Type API 响应错误:",e.message||e),e.response?(console.error("  HTTP 状态码:",e.response.status),console.error("  响应数据:",e.response.data)):e.request?console.error("  没有接收到响应"):console.error("  请求错误:",e.message),Promise.reject(e)));function g(){return _()}async function _(){return await n(500),{data:{ret:0,code:200,msg:"success",ret_data:[{id:1,device_type:"iPhone",device_type_code_id:"DT001",device_category:"charging",devices_count:15},{id:2,device_type:"Android Phone",device_type_code_id:"DT002",device_category:"charging",devices_count:12},{id:3,device_type:"Tablet",device_type_code_id:"DT003",device_category:"charging",devices_count:8},{id:4,device_type:"Laptop",device_type_code_id:"DT004",device_category:"charging",devices_count:5},{id:5,device_type:"Headphones",device_type_code_id:"DT005",device_category:"non-charging",devices_count:20}],timestamp:Date.now()},status:200,statusText:"OK",headers:{},config:{}}}function m(e){return p()}async function p(e){return await n(500),{data:{ret:0,code:200,msg:"设备类型添加成功",ret_data:Math.floor(Math.random()*1e3)+100,timestamp:Date.now()},status:200,statusText:"OK",headers:{},config:{}}}function f(e){return D(e)}async function D(e){return await n(500),{data:{ret:0,code:200,msg:"设备类型编辑成功",ret_data:e.id,timestamp:Date.now()},status:200,statusText:"OK",headers:{},config:{}}}function h(e){return!e||typeof e.id!="number"||e.id<=0?Promise.reject(new Error("Invalid device type id")):T(e)}async function T(e){return await n(500),{data:{ret:0,code:200,msg:"设备类型删除成功",ret_data:e.id,timestamp:Date.now()},status:200,statusText:"OK",headers:{},config:{}}}const I=v("deviceType",()=>{const e=l([]),o=l(!1),r=l(null),d=async()=>{var c;o.value=!0,r.value=null;try{console.log("开始加载设备类型列表...");const a=await g();if(console.log("API 响应:",a),a.data&&a.data.ret===0){const t=Array.isArray(a.data.ret_data)?a.data.ret_data:[];e.value=t,console.log(`✓ 设备类型列表加载成功，共 ${e.value?e.value.length:0} 条记录`)}else throw new Error(((c=a.data)==null?void 0:c.msg)||"获取设备类型列表失败")}catch(a){r.value=a instanceof Error?a.message:"获取设备类型列表失败",console.error("获取设备类型列表出错:",a),e.value=[]}finally{o.value=!1}};return{deviceTypeList:e,loading:o,error:r,loadDeviceTypeList:d,addDeviceType:async c=>{var a;o.value=!0,r.value=null;try{const t={device_type:c.device_type,device_category:c.device_category,devices_count:0},s=await m(t);if(s.data&&s.data.ret===0)return i.success("设备类型添加成功"),await d(),s.data.ret_data;throw new Error(((a=s.data)==null?void 0:a.msg)||"添加设备类型失败")}catch(t){throw r.value=t instanceof Error?t.message:"添加设备类型失败",i.error(r.value),console.error("添加设备类型出错:",t),t}finally{o.value=!1}},updateDeviceType:async c=>{var a;o.value=!0,r.value=null;try{if(!c.id)throw new Error("设备类型ID不存在");const t={id:c.id,device_type:c.device_type,device_category:c.device_category,devices_count:c.devices_count},s=await f(t);if(s.data&&s.data.ret===0)return i.success("设备类型更新成功"),await d(),s.data.ret_data;throw new Error(((a=s.data)==null?void 0:a.msg)||"更新设备类型失败")}catch(t){throw r.value=t instanceof Error?t.message:"更新设备类型失败",i.error(r.value),console.error("更新设备类型出错:",t),t}finally{o.value=!1}},deleteDeviceType:async c=>{var a;o.value=!0,r.value=null;try{const t=await h({id:c});if(t.data&&t.data.ret===0)return i.success("设备类型删除成功"),await d(),t.data.ret_data;throw new Error(((a=t.data)==null?void 0:a.msg)||"删除设备类型失败")}catch(t){throw r.value=t instanceof Error?t.message:"删除设备类型失败",i.error(r.value),console.error("删除设备类型出错:",t),t}finally{o.value=!1}}}});export{I as u};
