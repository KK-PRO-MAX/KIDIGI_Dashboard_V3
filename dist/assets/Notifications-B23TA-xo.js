import{_ as Z,r as _,c as ee,o as te,a as h,b,d as s,e as n,w as l,u as r,E as w,f as ae,g as p,n as M,h as v,i as x,s as se,j as oe,k as ne,F as I,l as E,m as L,p as re,t as y}from"./index-CZ0eQXdI.js";import{a as ie}from"./index-B9ygI19o.js";const le=i=>new Promise(o=>setTimeout(o,i)),T=ie.create({baseURL:"https://guiz.haomengwl.com/api",timeout:1e4,headers:{"Content-Type":"application/json"}});T.interceptors.request.use(i=>{const o=localStorage.getItem("token");return o&&(i.headers.token=o),i},i=>(console.error("请求拦截器错误:",i),Promise.reject(i)));T.interceptors.response.use(i=>i,i=>(console.error("响应拦截器错误:",i),Promise.reject(i)));function ce(i={}){return de(i)}async function de(i={}){await le(500);const o=[];for(let u=1;u<=20;u++){const m=Math.floor(Math.random()*32)+1,N=Math.floor(Math.random()*100)+1,D=Math.floor(Math.random()*30),g=new Date;g.setDate(g.getDate()-D),o.push({id:u,title:`Bay ${m} requires attention`,bay_num:m.toString(),is_complete:Math.random()>.5?1:0,other_connect:`Device connection status: ${Math.random()>.5?"Connected":"Disconnected"}`,user_name:`User${N}`,date_str:g.toLocaleDateString(),time_str:`${Math.floor(Math.random()*12)+1}:${Math.floor(Math.random()*60).toString().padStart(2,"0")} ${Math.random()>.5?"AM":"PM"}`})}return{data:{ret:0,code:200,msg:"success",ret_data:o,timestamp:Date.now()},status:200,statusText:"OK",headers:{},config:{}}}const ue={class:"notifications-page"},pe={class:"filter-section"},me={class:"top-layout"},ve={class:"sort-group"},fe={class:"middle-area"},ye={class:"import-export-group"},ge={class:"top-right"},_e={class:"notifications-list"},he={class:"item-left"},be={class:"top-row"},we={class:"bay-section"},Ne={class:"content-section"},ke={class:"user-info-container"},Ce={class:"user-name"},De={class:"device-info"},Se={class:"item-right"},Ae={class:"action-btns"},Me={class:"item-time"},xe={__name:"Notifications",setup(i){const o=_([]),f=_("priority"),u=_(""),m=_(""),N=_(!1),D=a=>a?a.split(/(?=Device:|SN:|NFC:|Charging:|Damage:)/).filter(e=>e.trim()!==""):[],g=ee(()=>{let a=[...o.value];if(m.value,f.value==="priority"?a.sort((e,t)=>t.id-e.id):a.sort((e,t)=>new Date(t.date_str)-new Date(e.date_str)),u.value.trim()){const e=u.value.toLowerCase();a=a.filter(t=>t.user_name.toLowerCase().includes(e)||t.bay_num.toString().includes(e)||t.title.toLowerCase().includes(e)||t.other_connect.toLowerCase().includes(e))}return a}),k=async()=>{N.value=!0;try{const a={};m.value,f.value==="time"?a.sort="desc":a.sort="asc";const e=await ce(a);if(e.data.ret===0){let t=e.data.ret_data;if(typeof t=="string")try{t=JSON.parse(t)}catch(d){console.error("解析通知数据失败:",d),t=[]}o.value=Array.isArray(t)?t:[]}else L.error(e.data.msg||"获取通知列表失败"),o.value=[]}catch(a){console.error("获取通知列表异常:",a),L.error("获取通知列表异常"),o.value=[]}finally{N.value=!1}},A=a=>{f.value=a,k()},j=()=>{k()},U=()=>{o.value=[]},$=a=>{o.value.splice(a,1)},B=a=>{console.log("打开Bay:",a)},O=a=>{const e=a.raw,t=new FileReader;t.onload=d=>{try{const c=JSON.parse(d.target.result);Array.isArray(c)&&(o.value=[...o.value,...c])}catch{const F=d.target.result.split(`
`).slice(1).filter(S=>S.trim()).map(S=>{const[R,P,z,q,J,K,G,Y,H,Q,W,X]=S.split(",");return{content:R||"",user:P||"",time:z||"",date:q||"",priority:Number(J)||1,bayNumber:Number(K)||0,deviceTypeID:G||"",deviceName:Y||"",serialNumber:H||"",nfcTag:Q||"",chargingStatus:W||"Unknown",damageStatus:X||"Unknown"}});o.value=[...o.value,...F]}},t.readAsText(e)},V=()=>{const e=[["content","user","time","date","priority","bayNumber","deviceTypeID","deviceName","serialNumber","nfcTag","chargingStatus","damageStatus"].join(","),...o.value.map(C=>Object.values(C).join(","))].join(`
`),t=new Blob([e],{type:"text/csv;charset=utf-8;"}),d=URL.createObjectURL(t),c=document.createElement("a");c.href=d,c.download=`notifications_${new Date().toISOString().slice(0,10)}.csv`,c.click(),URL.revokeObjectURL(d)};return te(()=>{k()}),(a,e)=>(b(),h("div",ue,[e[13]||(e[13]=s("h1",{class:"page-title"},"Notifications",-1)),s("div",pe,[n(r(ae),{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=t=>m.value=t),placeholder:"All Categories",clearable:"",style:{width:"200px"},onChange:k},{default:l(()=>[n(r(w),{label:"All Categories",value:""}),n(r(w),{label:"A1",value:"A1"}),n(r(w),{label:"A2",value:"A2"}),n(r(w),{label:"A3",value:"A3"}),n(r(w),{label:"A4",value:"A4"})]),_:1},8,["modelValue"])]),s("div",me,[s("div",ve,[n(r(v),{type:"primary",plain:"",class:M({"active-sort":f.value==="priority"}),onClick:e[1]||(e[1]=t=>A("priority"))},{default:l(()=>[...e[4]||(e[4]=[p(" Prioritization sorting ",-1)])]),_:1},8,["class"]),n(r(v),{type:"default",plain:"",class:M({"active-sort":f.value==="time"}),onClick:e[2]||(e[2]=t=>A("time"))},{default:l(()=>[...e[5]||(e[5]=[p(" Time sorting ",-1)])]),_:1},8,["class"])]),s("div",fe,[n(r(oe),{modelValue:u.value,"onUpdate:modelValue":e[3]||(e[3]=t=>u.value=t),placeholder:"Search user, device info, bay number, status...",class:"search-input",onInput:j},{prefix:l(()=>[n(r(x),{class:"search-icon"},{default:l(()=>[n(r(se))]),_:1})]),_:1},8,["modelValue"]),s("div",ye,[n(r(ne),{class:"upload-btn",action:"#","auto-upload":!1,"on-change":O,accept:".csv,.json"},{default:l(()=>[n(r(v),{type:"success",plain:""},{default:l(()=>[...e[6]||(e[6]=[p("Import File",-1)])]),_:1})]),_:1}),n(r(v),{type:"primary",plain:"",onClick:V},{default:l(()=>[...e[7]||(e[7]=[p("Export File",-1)])]),_:1})])]),s("div",ge,[e[9]||(e[9]=s("div",{class:"system-time"},[s("div",null,"12:52:21 PM"),s("div",null,"May 6th, 2025")],-1)),n(r(v),{style:{"background-color":"#FF0400","font-weight":"700"},type:"danger",onClick:U},{default:l(()=>[...e[8]||(e[8]=[p("Clear All",-1)])]),_:1})])]),s("div",_e,[(b(!0),h(I,null,E(g.value,(t,d)=>(b(),h("div",{key:t.id,class:"notification-item"},[s("div",he,[s("div",be,[s("div",we,[n(r(x),null,{default:l(()=>[n(r(re))]),_:1}),p(" BAY "+y(t.bay_num),1)]),s("div",Ne,y(t.title),1)]),s("div",ke,[e[10]||(e[10]=s("div",{class:"user-label"},"USER",-1)),s("div",Ce,y(t.user_name),1)]),s("div",De,[(b(!0),h(I,null,E(D(t.other_connect),(c,C)=>(b(),h("span",{key:C},y(c),1))),128))])]),s("div",Se,[s("div",Ae,[n(r(v),{type:"primary",plain:"",onClick:c=>B(t)},{default:l(()=>[...e[11]||(e[11]=[p(" Open Bay ",-1)])]),_:1},8,["onClick"]),n(r(v),{type:"default",plain:"",onClick:c=>$(d)},{default:l(()=>[...e[12]||(e[12]=[p(" Dismiss ",-1)])]),_:1},8,["onClick"])]),s("div",Me,[s("div",null,y(t.time_str),1),s("div",null,y(t.date_str),1)])])]))),128))])]))}},Le=Z(xe,[["__scopeId","data-v-0a5d4f4a"]]);export{Le as default};
